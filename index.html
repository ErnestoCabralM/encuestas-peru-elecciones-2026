<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Encuestas Perú 2026</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>

/* FUENTE */
@font-face {
  font-family: 'ArminGrotesk-bold';
  src: url('armin-grotesk-bold.woff2') format('woff2');
}

body{
  font-family:'ArminGrotesk-bold', sans-serif;
  padding:20px;
  padding-top:130px;
  background:#086495;
}

/* LOGO FIJO REAL */
.logo{
  position:fixed;
  top:20px;
  right:40px;
  height:90px;
  z-index:9999;
}

/* TITULO */
.titulo-principal{
  background:#CF2C0B;
  color:#F6DBAF;
  display:inline-block;
  padding:12px 15px;
  border-radius:6px;
  margin-bottom:18px;
  font-weight:700;
  font-size:48px;
  letter-spacing:1px;
}

/* SUBTITULO */
.subtitulo{
  background:#F2A33F;
  color:#020107;
  padding:8px 12px;
  border-radius:6px;
  line-height:1.4;
  font-weight:600;
  margin-bottom:28px;
  display:inline-block;
  max-width:900px;
}

h3{
  color:#F2A33F;
  margin:18px 0 6px 0;
  font-weight:600
}

.button-group{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-bottom:14px
}

button{
  padding:6px 10px;
  border:1px solid #ccc;
  cursor:pointer;
  background:white;
  border-radius:6px
}
button.active-encuesta{
  background:#333;
  color:white;
  border-color:#333
}

.fuente{
  margin-top:14px;
  color:white;
  font-size:14px;
}

/* BUSCADOR */
.search-box{position:relative;max-width:420px}
#buscador{
  width:100%;
  padding:8px;
  border:1px solid #ccc;
  border-radius:6px
}
.sugerencias{
  position:absolute;
  top:38px;
  left:0;
  right:0;
  border:1px solid #ddd;
  background:white;
  max-height:180px;
  overflow:auto;
  z-index:10;
  border-radius:6px
}
.sugerencias div{
  padding:6px 8px;
  cursor:pointer
}
.sugerencias div:hover{background:#f0f0f0}

/* CHIPS */
.chips{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  margin-top:10px
}
.chip{
  padding:6px 10px;
  border-radius:20px;
  color:white;
  font-size:14px;
  display:flex;
  align-items:center;
  gap:8px
}
.chip span{
  cursor:pointer;
  font-weight:bold
}

/* GRAFICO */
.chart-wrap{
  background:#F6DBAF;
  padding:6px;
  border-radius:6px;
}

.grafico-container{
  position:relative;
  width:100%;
  height:480px;
}

@media (max-width:768px){
  .grafico-container{
    height:auto;
    aspect-ratio:1/1;
  }
}

</style>
</head>

<body>

<img src="logo.png" class="logo">

<div class="titulo-principal">COMPARA ENCUESTAS</div>

<div class="subtitulo">
Hemos consolidado todas las encuestas electorales. Elige uno o más candidatos presidenciales y descubre su intención de voto.
</div>

<h3>Busca y agrega candidatos</h3>
<div class="search-box">
  <input id="buscador" placeholder="Escribe un nombre..." />
  <div id="sugerencias" class="sugerencias" style="display:none"></div>
</div>
<div id="chips" class="chips"></div>

<h3>Elige una encuesta</h3>
<div id="encuestas-container" class="button-group"></div>

<div class="chart-wrap">
  <div class="grafico-container">
    <canvas id="grafico"></canvas>
  </div>
</div>

<div class="fuente">
Fuente: Ipsos, IEP, CPI y Datum
</div>

<script>
window.onload = function(){

const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR2lpNTnGdTb9RxRNujPEjF3ihNgw7IN-WPN-zG4-DJmXvYNyuc1GYPp2npeGKmnZIeNm50Fi3AZIHS/pub?gid=1021106762&single=true&output=csv";

let rawData = [];
let chart;
let encuestaActiva = null;
let candidatosSeleccionados = [];

const COLORES = ["#4E79A7","#F28E2B","#E15759","#76B7B2","#59A14F",
"#EDC948","#B07AA1","#FF9DA7","#9C755F","#BAB0AC"];

const mapaColorCandidato = {};
let listaCandidatos = [];

const MESES = {ene:1,feb:2,mar:3,abr:4,may:5,jun:6,jul:7,ago:8,sep:9,oct:10,nov:11,dic:12};

function ordenarFechas(a,b){
  const [ma,ya]=a.toLowerCase().split(" ");
  const [mb,yb]=b.toLowerCase().split(" ");
  return (ya-yb)||(MESES[ma]-MESES[mb]);
}

Papa.parse(CSV_URL + "&t=" + new Date().getTime(),{
  download:true,
  header:true,
  complete:function(res){
    rawData=res.data.map(r=>({
      fecha:r.fecha?.trim(),
      encuesta:r.encuesta?.trim(),
      candidato:r.candidato?.trim(),
      tipo:r.Tipo?.trim()||'',
      valor:parseFloat(r.valor)
    }));
    iniciar();
  }
});

function iniciar(){
  listaCandidatos=[...new Set(
    rawData.filter(d=>d.tipo==="Candidato oficial").map(d=>d.candidato)
  )].sort();

  listaCandidatos.forEach((c,i)=>{
    mapaColorCandidato[c]=COLORES[i % COLORES.length];
  });

  iniciarBuscador();
  iniciarEncuestas();

  chart=new Chart(document.getElementById("grafico"),{
    type:"line",
    data:{labels:[],datasets:[]},
    options:{
      responsive:true,
      maintainAspectRatio:false,
      plugins:{legend:{display:false}},
      scales:{
        y:{
          min:0,
          max:16,
          ticks:{
            callback:(v)=> v + '%'
          }
        }
      }
    }
  });
}

function iniciarBuscador(){
  const input=document.getElementById("buscador");
  const box=document.getElementById("sugerencias");

  input.addEventListener("input",()=>{
    const q=input.value.toLowerCase();
    box.innerHTML="";
    if(!q){box.style.display="none";return;}

    listaCandidatos
      .filter(c=>c.toLowerCase().includes(q) && !candidatosSeleccionados.includes(c))
      .forEach(c=>{
        const div=document.createElement("div");
        div.textContent=c;
        div.onclick=()=>{agregarChip(c); box.style.display="none"; input.value="";};
        box.appendChild(div);
      });

    box.style.display="block";
  });
}

function agregarChip(c){
  candidatosSeleccionados.push(c);

  const chip=document.createElement("div");
  chip.className="chip";
  chip.style.backgroundColor=mapaColorCandidato[c];
  chip.textContent=c;

  const x=document.createElement("span");
  x.textContent="✕";
  x.onclick=()=>{
    chip.remove();
    candidatosSeleccionados=candidatosSeleccionados.filter(a=>a!==c);
    actualizar();
  };

  chip.appendChild(x);
  document.getElementById("chips").appendChild(chip);
  actualizar();
}

function iniciarEncuestas(){
  const encuestas=[...new Set(rawData.map(d=>d.encuesta))].sort();
  const cont=document.getElementById("encuestas-container");

  encuestas.forEach((e,i)=>{
    const b=document.createElement("button");
    b.textContent=e;

    if(i===0){ encuestaActiva=e; b.classList.add("active-encuesta"); }

    b.onclick=()=>{
      document.querySelectorAll("#encuestas-container button")
        .forEach(x=>x.classList.remove("active-encuesta"));
      b.classList.add("active-encuesta");
      encuestaActiva=e;
      actualizar();
    };

    cont.appendChild(b);
  });
}

function actualizar(){
  if(!encuestaActiva || !candidatosSeleccionados.length) return;

  const filtrado=rawData.filter(d=>
    candidatosSeleccionados.includes(d.candidato)&&
    d.encuesta===encuestaActiva
  );

  const fechas=[...new Set(filtrado.map(d=>d.fecha))].sort(ordenarFechas);

  chart.data.labels=fechas;
  chart.data.datasets=candidatosSeleccionados.map(c=>{
    return{
      label:c,
      data:fechas.map(f=>{
        const r=filtrado.find(x=>x.fecha===f && x.candidato===c);
        return r? r.valor:null;
      }),
      borderColor:mapaColorCandidato[c],
      tension:0.3,
      spanGaps:true
    };
  });

  chart.update();
}

}
</script>

</body>
</html>



